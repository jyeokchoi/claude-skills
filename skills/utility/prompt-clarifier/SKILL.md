---
name: prompt-clarifier
description: 모호한 요청을 감지하고 AskUserQuestion으로 명확화하여 구체화된 요청을 출력한다. 작업 수행은 하지 않는다.
argument-hint: 'Usage: /prompt-clarifier <요청>'
---

# Prompt Clarifier

사용자의 요청이 모호하거나 구체화가 필요할 때, 코드베이스 탐색과 명확화 질문을 통해 **구체적이고 실행 가능한 요청**으로 변환하는 스킬.

이 스킬은 **명확화만 수행**한다. 작업 실행은 사용자가 출력된 구체화 요청을 `/vwork`, `/vimpl` 등 적절한 스킬에 전달하여 수행한다.

## 입력

- 원시 인자: $ARGUMENTS

$ARGUMENTS가 비어 있으면:

```yaml
AskUserQuestion:
  question: "어떤 작업을 도와드릴까요?"
  header: "요청 입력"
  options:
    - label: "직접 입력"
      description: "Other를 선택해 요청을 입력하세요"
```

사용자의 응답을 `$ARGUMENTS`로 간주하고 1단계로 진행한다.

## 1단계: 코드베이스 탐색 (사전 조사)

모호성 판정 전에 코드베이스 신호를 수집한다. 이 정보는 판정과 질문 생성 모두에 사용된다.

병렬 실행:

```bash
# [A] 최근 변경 파일
git diff --stat HEAD~5 2>/dev/null | head -20

# [B] 현재 브랜치/상태
git branch --show-current 2>/dev/null
git status --short 2>/dev/null | head -10
```

```
# [C] 프로젝트 구조 (Glob)
# src/ 존재 시: src/**/*
# src/ 없으면: 루트의 주요 디렉토리 탐색 (lib/, app/, packages/, cmd/ 등)
# 둘 다 없으면: 루트 레벨 파일/디렉토리 목록
```

```
# [D] 활성 워크로그 확인
.claude/worklogs/.active 존재 여부 확인
있으면 워크로그의 Goal, Completion Criteria 읽기
```

수집 결과를 `$CODEBASE_CONTEXT`로 보관한다.

## 2단계: 모호성 판정

아래 기준으로 요청을 분석한다. **명확함을 먼저 평가**하고, 해당하지 않는 경우에만 모호함을 평가한다.

### 판정 우선순위

```
1. 명확함 기준 평가 → 하나라도 해당 → 4단계 (출력)
2. 추론 가능한 모호성 확인 → $CODEBASE_CONTEXT로 해소 가능 → 4단계 (출력)
3. 모호함 기준 평가 → 하나라도 해당 → 3단계 (질문)
4. 어디에도 해당 없음 → 4단계 (출력, 의도적 safe default: 판단 불가 시 질문보다 진행 우선)
```

### 명확함 (→ 4단계로)

다음 중 하나라도 해당하면 질문 없이 바로 구체화 출력:

- 특정 파일, 함수, 클래스, 모듈을 지정 (`src/auth.ts의 login 함수`)
- 행동 + 대상 + 기대 결과가 모두 포함
- 탐색/이해 요청이고 범위가 명시됨 ("src/api/ 디렉토리 구조를 설명해줘")
- 대화 맥락 연속: 직전 5개 메시지 내에 구체적 파일/함수/에러가 언급되었고, 대명사의 지시 대상이 맥락에서 유일하게 식별 가능

### 추론 가능한 모호성 (→ 4단계로)

$CODEBASE_CONTEXT를 활용하여 질문 없이 해소할 수 있는 경우:

- 대상이 명시되지 않았지만 `git diff`/`git status`에서 유일한 변경 파일이 식별됨
- 대상이 명시되지 않았지만 Grep/Glob으로 유일하게 매칭되는 심볼이 있음
- 활성 워크로그의 Goal이 요청의 맥락을 충분히 제공함
- 작업 종류가 명시되지 않았지만 대상의 성격에서 자명 (e.g., `tsconfig.json` = 설정 변경)

추론으로 해소한 경우, 4단계에서 추론 근거를 함께 출력한다.

### 모호함 (→ 3단계로)

위 두 단계를 거쳐도 해소되지 않는 경우, 다음 중 하나라도 해당하면 모호하다:

| 신호 | 한국어 예시 | English 예시 |
|------|------------|-------------|
| 대상 없는 대명사 | "이거 고쳐줘", "그거 수정해" | "fix this", "change that" |
| 대상 불명확한 동사 | "코드 정리해줘", "성능 개선해줘" | "clean up the code", "improve performance" |
| 다중 해석 불가피 | "새 기능 만들어줘", "API 만들어줘" | "build a new feature", "create an API" |
| 범위 불분명 | "버그 고쳐줘" (재현 방법 불명) | "fix the bug" (which bug?) |

## 3단계: 명확화 질문

### 3-1. 질문 생성

요청의 **구체적인 모호 지점**을 해소할 질문을 생성한다.

규칙:
- 각 질문에 2~4개의 **구체적이고 실행 가능한** 선택지 + "기타(직접 입력)" 포함
- 선택지는 $CODEBASE_CONTEXT에서 실제 존재하는 파일/모듈/함수로 채운다. 추측하지 않는다.
- 일반적 선호가 아닌, **이 요청의 모호함을 직접 해소**하는 질문만

### 3-2. 질문 실행

**가장 중요한 질문(대상 지정)을 먼저 1회 질문한다.**

```yaml
# 예시
AskUserQuestion:
  question: "어떤 파일/모듈을 수정할까요?"
  header: "대상 지정"
  options:
    - label: "src/auth/ (인증 모듈)"
      description: "최근 수정됨 — git diff에서 3개 파일 변경 감지"
    - label: "src/api/ (API 레이어)"
      description: "API 엔드포인트 및 라우팅"
    - label: "직접 입력"
      description: "Other를 선택해 경로를 입력하세요"
```

첫 답변으로 나머지 모호 지점이 자동 해소되는지 평가한다.
해소되지 않는 경우에만 추가 질문을 **최대 1회** 더 한다 (총 최대 2회).

2회 이후에도 모호하면 최선의 해석으로 진행하되, 4단계에서 해석 근거를 명시한다.

## 4단계: 구체화 결과 출력

수집된 정보(원래 요청 + 코드베이스 탐색 + 질문 답변)를 결합하여 구체화된 요청을 출력한다.

### 출력 형식

```markdown
## 구체화된 요청

**원래 입력:** {$ARGUMENTS}

**구체화:**
{모호 지점별 해소 결과를 서술형으로 작성. 고정 템플릿이 아닌, 실제 수집된 내용에 맞는 자연스러운 서술.}

{추론으로 해소한 경우에만 아래 블록을 포함. 질문으로 해소한 경우 생략.}
**추론 근거:** {코드베이스 탐색 또는 대화 맥락에서 추론한 근거}

**추천 다음 단계:**
- `/vwork {요약}` — 전체 워크플로우 파이프라인
- `/vplan {요약}` — 플래닝만 먼저
- `/vimpl {요약}` — 바로 구현
- 또는 구체화된 요청을 그대로 프롬프트로 사용
```

출력 후 AskUserQuestion으로 확인:

```yaml
AskUserQuestion:
  question: "이 해석이 맞나요?"
  header: "확인"
  options:
    - label: "맞습니다"
      description: "추천 다음 단계 중 하나를 선택하거나 직접 진행하세요"
    - label: "수정이 필요합니다"
      description: "Other를 선택해 수정 사항을 입력하세요"
```

- "맞습니다" → 스킬 종료. 사용자가 다음 행동 선택.
- "수정 필요" → 수정 사항을 반영하여 4단계를 다시 실행. 최대 2회 수정 후 최종 출력으로 확정.

## 오케스트레이션 컨텍스트

`_shared/orchestration-context.md`를 로드하고 **서브 스킬 — 읽기** 프로토콜을 따른다.

- `ORCHESTRATED=true` + `auto` 모드: 구체화 결과만 출력하고 종료. 확인 질문 생략. vwork가 결과를 읽고 다음 phase를 결정한다.
- `ORCHESTRATED=true` + `step` 모드: 구체화 결과 출력 + 4단계 확인 질문을 수행. 사용자 확인 후 종료.
- `ORCHESTRATED=false` (standalone): 위 4단계의 전체 출력 + 확인 질문을 수행.

## 불변 규칙

1. **작업을 수행하지 않는다.** 이 스킬은 명확화만 한다. 코드 수정, 파일 생성, 스킬 호출을 하지 않는다.
2. **코드베이스 탐색 없이 선택지를 추측하지 않는다.** 모든 선택지는 Glob/Grep/git 결과에 기반한다.
3. **질문은 최대 2회.** 2회 이후에도 모호하면 최선의 해석 + 근거 명시로 진행한다.
4. **명확함 우선.** 명확함 기준에 해당하면 질문하지 않는다. 대화 맥락에서 대상이 식별 가능하면 질문하지 않는다.

이제 실행하라.
